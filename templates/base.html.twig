<!DOCTYPE html>
<html lang="en">
	<head>
		{% block head %}
			<meta charset="UTF-8">
			<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
			<meta name="robots" content="noindex,follow" />
			<title>{% block title %}Welcome!{% endblock %}</title>
			<link rel="icon" href="/uploads/favicon/fav-icon.png"> 
			<link rel="stylesheet" href="{{ asset('styles/reset.css') }}">
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
			<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
			<link rel="stylesheet" href="{{ asset('styles/global.css') }}">
			<link rel="stylesheet" href="{{ asset('styles/extraBootstrap.css') }}">
			<link rel="stylesheet" href="{{ asset('styles/sidebar.css') }}">
			<link rel="stylesheet" href="{{ asset('styles/base.css') }}">
		{% endblock %}
	</head>
	<body class="d-flex flex-column">
		<aside>
			{% if not exclude_sidebar|default(false) %}
				{% include 'sidebar/sidebar.html.twig' %}
			{% endif %}
		</aside>
		{# creates a header to go to dashboard if you are admin and for everybody to logout
			you can assign the headertitle with a {% block headertitle %}title{% endblock %} #}
		{% if is_granted('ROLE_USER') %}
			{% if not exclude_header|default(false) %}
				<header class='custom d-flex flex-row justify-content-between p-3 {{ app.request.cookies.get('sidebarState', 'Close') == 'Open' ? 'sideOpen' : 'sidefixed' }}'>
					<article class='d-flex flex-row align-items-center'>
						<a href="{{ path('home') }}">
							<img src="/uploads/logo/logo.png" alt="Logo" class="logo" />
						</a>
					</article>
					<article class='d-flex flex-row align-items-center ms-auto'>
						{# Render for the Notifications #}
						{{ render(controller('App\\Controller\\HomeController::loadNotifications')) }}
						{# Render for the Changelog #}
						{{ render(controller('App\\Controller\\HomeController::loadChangelog'))  }}
						<div class='profileToolOverlay'></div>
						<div class ='profileTool'>
							<span><i class="bi bi-person-circle fs-2 ms-4 text-light profile-icon"></i></span>
							<div class="profileToolDropdown">
								<div class='d-flex flex-column'>
									<a href="{{ path('profile_view', {'id': app.user.id}) }}" class="btn bg-color-sky-blue mb-1">
										Mijn profiel
									</a>
									<a class="logout-link btn bg-color-sky-blue" href="{{ path('logout') }}">Uitloggen</a>
								</div>
							</div>
						</div>
					</article>
				</header>
			{% endif %}

		{% endif %}
			{% if not exclude_header|default(false) %}
			<main class=" {{ app.request.cookies.get('sidebarState', 'Close') == 'Open' ? 'sideOpen' : 'sideCollapsed' }} mt-3">
			{% else %}
			<main class="">	
			{% endif %}
			{% block body %}
			{% endblock %}
		</main>
		<script src="{{ asset('js/toaster.js')}}"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
		</script>
		<script>
		


		{% if not exclude_header|default(false) %}
			let isActive = false;
			// Function to ping the server to keep the session alive
			function keepSessionAlive() {
				if(!isActive) {
					isActive = true;
					fetch('/keep-alive', {
					method: 'POST',
					credentials: 'same-origin' // Send cookies with the request
				})
				.then(response => {
					if (!response.ok) {
						console.warn('Failed to keep session alive.');
					}
					isActive = false;
				})
				.catch(error => console.error('Error in keep-alive request:', error));
				}
				
			}

			// Attach event listeners to reset the timeout on user activity
			window.onload = keepSessionAlive;
			document.onkeypress = keepSessionAlive;
			
			document.addEventListener('DOMContentLoaded', function () {
				//open and closing of the changelog
				const profileTool = document.querySelector('.profileTool');
				const profileToolDropdown = document.querySelector('.profileToolDropdown');
				const profileTooloverlay = document.querySelector('.profileToolOverlay');

				function closeProfileTool() {
					profileToolDropdown.style.display = 'none';
					profileTooloverlay.style.display='none';
				}
				
				profileTool.addEventListener('click', function () {
					profileToolDropdown.style.display = 'block';
					profileTooloverlay.style.display='block';
				});
				
				profileTooloverlay.addEventListener('click', function (event) {
					event.stopPropagation(); // Voorkom dat het klikgedrag opnieuw wordt getriggerd
					closeProfileTool();
				}); 
			})
			
		{% endif %}
		</script>
	</body>
</html>